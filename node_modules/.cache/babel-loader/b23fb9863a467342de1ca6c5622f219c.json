{"ast":null,"code":"var _jsxFileName = \"/Users/medina/development/sigma-sankey-plugin/src/App.js\",\n    _s = $RefreshSig$();\n\nimport \"./App.css\";\nimport { useMemo, useRef, useLayoutEffect } from \"react\";\nimport * as am5 from '@amcharts/amcharts5';\nimport * as am5Flow from '@amcharts/amcharts5/flow';\nimport { client, useConfig, useElementData } from \"@sigmacomputing/plugin\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nclient.config.configureEditorPanel([{\n  name: \"source\",\n  type: \"element\"\n}, {\n  name: \"dimension\",\n  type: \"column\",\n  source: \"source\",\n  allowMultiple: true\n}, {\n  name: \"measures\",\n  type: \"column\",\n  source: \"source\",\n  allowMultiple: true\n}]);\n\nfunction App() {\n  _s();\n\n  const config = useConfig();\n  const sigmaData = useElementData(config.source);\n  const ref = useRef();\n  const options = useMemo(() => {\n    console.log(config.sigmaData);\n    const dimensions = config.dimension;\n    const measures = config.measures; // transform sigmaData --> sankey data\n\n    let dataMap = [];\n\n    if (dimensions && (sigmaData === null || sigmaData === void 0 ? void 0 : sigmaData[dimensions[0]])) {\n      for (let i = 0; i < dimensions.length - 1; i++) {\n        for (let j = 0; j < sigmaData[dimensions[i]].length; j++) {\n          const from = sigmaData[dimensions[i]][j];\n          const to = sigmaData[dimensions[i + 1]][j];\n          const weight = sigmaData[measures[i]][j];\n          const dataPoint = [from, to, weight];\n          dataMap[dataPoint] = dataPoint;\n        }\n      }\n\n      let data = [];\n      let i = 0;\n\n      for (var key in dataMap) {\n        data[i] = dataMap[key];\n        i++;\n      }\n\n      let root = am5.Root.new(\"chartdiv\");\n      let series = root.container.children.push(am5Flow.Sankey.new(root, {\n        sourceIdField: \"from\",\n        targetIdField: \"to\",\n        valueField: \"value\",\n        paddingRight: 150,\n        nodeAlign: 'left',\n        nodePadding: 100,\n        nodeWidth: 8,\n        linkTension: 0,\n        idField: \"id\"\n      }));\n      series.links.template.setAll({\n        fillOpacity: 0.55,\n        fillStyle: \"source\",\n        controlPointDistance: 0\n      });\n      series.nodes.rectangles.template.adapters.add('tooltipText', function (tooltipText, target) {\n        const links = target.dataItem._settings.incomingLinks || [];\n        let toolTip = \"\";\n\n        if (links && links.length > 0) {\n          links.forEach(node => {\n            toolTip += `${node.dataContext.from} - ${node.dataContext.value} \\n`;\n          });\n        }\n\n        return toolTip;\n      });\n      series.nodes.labels.template.setAll({\n        text: \"[bold]{name}: {sumIncoming}\"\n      });\n\n      if (options && options.length > 0) {\n        series.data.setAll(options);\n      } else {\n        series.data.setAll([]);\n      }\n\n      root.current = root;\n      series.appear(1000, 500);\n    }\n  }, [config, sigmaData]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"chartdiv\",\n    style: {\n      width: \"100%\",\n      height: \"98vh\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"M3PMrxS3QZkKj02N9zl80Pb62sI=\", false, function () {\n  return [useConfig, useElementData];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/medina/development/sigma-sankey-plugin/src/App.js"],"names":["useMemo","useRef","useLayoutEffect","am5","am5Flow","client","useConfig","useElementData","config","configureEditorPanel","name","type","source","allowMultiple","App","sigmaData","ref","options","console","log","dimensions","dimension","measures","dataMap","i","length","j","from","to","weight","dataPoint","data","key","root","Root","new","series","container","children","push","Sankey","sourceIdField","targetIdField","valueField","paddingRight","nodeAlign","nodePadding","nodeWidth","linkTension","idField","links","template","setAll","fillOpacity","fillStyle","controlPointDistance","nodes","rectangles","adapters","add","tooltipText","target","dataItem","_settings","incomingLinks","toolTip","forEach","node","dataContext","value","labels","text","current","appear","width","height"],"mappings":"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","sourcesContent":["import \"./App.css\";\n\nimport { useMemo, useRef, useLayoutEffect } from \"react\";\nimport * as am5 from '@amcharts/amcharts5';\nimport * as am5Flow from '@amcharts/amcharts5/flow';\n\nimport {\n  client,\n  useConfig,\n  useElementData,\n} from \"@sigmacomputing/plugin\";\n\nclient.config.configureEditorPanel([\n  { name: \"source\", type: \"element\" },\n  { name: \"dimension\", type: \"column\", source: \"source\", allowMultiple: true },\n  { name: \"measures\", type: \"column\", source: \"source\", allowMultiple: true },\n]);\n\nfunction App() {\n  const config = useConfig();\n  const sigmaData = useElementData(config.source);\n  const ref = useRef();\n\n  const options = useMemo(() => {\n    console.log(config.sigmaData);\n    const dimensions = config.dimension;\n    const measures = config.measures;\n\n    // transform sigmaData --> sankey data\n    let dataMap = [];\n    if (dimensions && sigmaData?.[dimensions[0]]) {\n      for (let i = 0; i < dimensions.length - 1; i++) {\n        for (let j = 0; j < sigmaData[dimensions[i]].length; j++) {\n          const from = sigmaData[dimensions[i]][j];\n          const to = sigmaData[dimensions[i + 1]][j];\n          const weight = sigmaData[measures[i]][j];\n          const dataPoint = [from, to, weight];\n          dataMap[dataPoint] = dataPoint;\n        }\n      }\n      let data = [];\n      let i = 0;\n      for (var key in dataMap) {\n        data[i] = dataMap[key];\n        i++;\n      }\n\n      let root = am5.Root.new(\"chartdiv\");\n      let series = root.container.children.push(\n        am5Flow.Sankey.new(root, {\n          sourceIdField: \"from\",\n          targetIdField: \"to\",\n          valueField: \"value\",\n          paddingRight: 150,\n          nodeAlign: 'left',\n          nodePadding: 100,\n          nodeWidth: 8,\n          linkTension: 0,\n          idField: \"id\",\n        })\n      );\n    \n      series.links.template.setAll({\n        fillOpacity: 0.55,\n        fillStyle: \"source\",\n        controlPointDistance: 0,\n      });\n    \n      series.nodes.rectangles.template.adapters.add('tooltipText', function(tooltipText, target) {\n        const links = target.dataItem._settings.incomingLinks || [];\n        let toolTip = \"\";\n    \n        if (links && links.length > 0) {\n          links.forEach((node) => {\n            toolTip += `${node.dataContext.from} - ${node.dataContext.value} \\n`;\n          });\n        } \n        return toolTip;\n      });\n    \n    \n      series.nodes.labels.template.setAll({\n        text: \"[bold]{name}: {sumIncoming}\"\n      });\n    \n      if (options && options.length > 0) {\n        series.data.setAll(options);\n      } else {\n        series.data.setAll([]);\n      }\n    \n      root.current = root;\n      series.appear(1000, 500);\n    }\n  }, [config, sigmaData]);\n\n  return (\n    <div id=\"chartdiv\" style={{ width: \"100%\", height: \"98vh\"}}></div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}