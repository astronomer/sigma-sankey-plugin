{"ast":null,"code":"var _jsxFileName = \"/Users/medina/development/sigma-sankey-plugin/src/App.js\",\n    _s = $RefreshSig$();\n\nimport \"./App.css\";\nimport { useMemo, useRef } from \"react\";\nimport * as am5 from '@amcharts/amcharts5';\nimport * as am5Flow from '@amcharts/amcharts5/flow';\nimport { client, useConfig, useElementData } from \"@sigmacomputing/plugin\";\nimport { useEffect } from \"react/cjs/react.production.min\";\nimport { randomNormal } from \"d3\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nclient.config.configureEditorPanel([{\n  name: \"source\",\n  type: \"element\"\n}, {\n  name: \"dimension\",\n  type: \"column\",\n  source: \"source\",\n  allowMultiple: true\n}, {\n  name: \"measures\",\n  type: \"column\",\n  source: \"source\",\n  allowMultiple: true\n}]);\n\nfunction App() {\n  _s();\n\n  const config = useConfig();\n  const sigmaData = useElementData(config.source);\n  const ref = useRef();\n  let root;\n  const options = useMemo(() => {\n    console.log(config.sigmaData);\n    const dimensions = config.dimension;\n    const measures = config.measures; // transform sigmaData --> sankey data\n\n    let dataMap = [];\n\n    if (dimensions && (sigmaData === null || sigmaData === void 0 ? void 0 : sigmaData[dimensions[0]])) {\n      for (let i = 0; i < dimensions.length - 1; i++) {\n        for (let j = 0; j < sigmaData[dimensions[i]].length; j++) {\n          const from = sigmaData[dimensions[i]][j];\n          const to = sigmaData[dimensions[i + 1]][j];\n          const weight = sigmaData[measures[i]][j];\n          const dataPoint = [from, to, weight];\n          dataMap[dataPoint] = dataPoint;\n        }\n      }\n\n      let data = [];\n      let i = 0;\n\n      for (var key in dataMap) {\n        data[i] = dataMap[key];\n        i++;\n      }\n    }\n  }, [config, sigmaData]);\n  am5.ready(function () {\n    root = am5.Root.new(\"chartdiv\");\n    let series = root.container.children.push(am5Flow.Sankey.new(root, {\n      sourceIdField: \"from\",\n      targetIdField: \"to\",\n      valueField: \"value\",\n      paddingRight: 150,\n      nodeAlign: 'left',\n      nodePadding: 100,\n      nodeWidth: 8,\n      linkTension: 0,\n      idField: \"id\"\n    }));\n    series.links.template.setAll({\n      fillOpacity: 0.55,\n      fillStyle: \"source\",\n      controlPointDistance: 0\n    });\n    series.nodes.rectangles.template.adapters.add('tooltipText', function (tooltipText, target) {\n      const links = target.dataItem._settings.incomingLinks || [];\n      let toolTip = \"\";\n\n      if (links && links.length > 0) {\n        links.forEach(node => {\n          toolTip += `${node.dataContext.from} - ${node.dataContext.value} \\n`;\n        });\n      }\n\n      return toolTip;\n    });\n    series.nodes.labels.template.setAll({\n      text: \"[bold]{name}: {sumIncoming}\"\n    });\n\n    if (options && options.length > 0) {\n      series.data.setAll(options);\n    } else {\n      series.data.setAll([]);\n    }\n\n    this.root = root;\n    series.appear(1000, 500);\n  });\n  useEffect(() => {\n    if (this.root) {\n      root.dispose();\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"chartdiv\",\n    style: {\n      width: \"100%\",\n      height: \"98vh\"\n    },\n    ref: ref\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"koEhH6mc9OT6/ki/ZS3vd87365c=\", false, function () {\n  return [useConfig, useElementData];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/medina/development/sigma-sankey-plugin/src/App.js"],"names":["useMemo","useRef","am5","am5Flow","client","useConfig","useElementData","useEffect","randomNormal","config","configureEditorPanel","name","type","source","allowMultiple","App","sigmaData","ref","root","options","console","log","dimensions","dimension","measures","dataMap","i","length","j","from","to","weight","dataPoint","data","key","ready","Root","new","series","container","children","push","Sankey","sourceIdField","targetIdField","valueField","paddingRight","nodeAlign","nodePadding","nodeWidth","linkTension","idField","links","template","setAll","fillOpacity","fillStyle","controlPointDistance","nodes","rectangles","adapters","add","tooltipText","target","dataItem","_settings","incomingLinks","toolTip","forEach","node","dataContext","value","labels","text","appear","dispose","width","height"],"mappings":";;;AAAA,OAAO,WAAP;AAEA,SAASA,OAAT,EAAkBC,MAAlB,QAAgC,OAAhC;AACA,OAAO,KAAKC,GAAZ,MAAqB,qBAArB;AACA,OAAO,KAAKC,OAAZ,MAAyB,0BAAzB;AAEA,SACEC,MADF,EAEEC,SAFF,EAGEC,cAHF,QAIO,wBAJP;AAKA,SAASC,SAAT,QAA0B,gCAA1B;AACA,SAASC,YAAT,QAA6B,IAA7B;;AAEAJ,MAAM,CAACK,MAAP,CAAcC,oBAAd,CAAmC,CACjC;AAAEC,EAAAA,IAAI,EAAE,QAAR;AAAkBC,EAAAA,IAAI,EAAE;AAAxB,CADiC,EAEjC;AAAED,EAAAA,IAAI,EAAE,WAAR;AAAqBC,EAAAA,IAAI,EAAE,QAA3B;AAAqCC,EAAAA,MAAM,EAAE,QAA7C;AAAuDC,EAAAA,aAAa,EAAE;AAAtE,CAFiC,EAGjC;AAAEH,EAAAA,IAAI,EAAE,UAAR;AAAoBC,EAAAA,IAAI,EAAE,QAA1B;AAAoCC,EAAAA,MAAM,EAAE,QAA5C;AAAsDC,EAAAA,aAAa,EAAE;AAArE,CAHiC,CAAnC;;AAMA,SAASC,GAAT,GAAe;AAAA;;AACb,QAAMN,MAAM,GAAGJ,SAAS,EAAxB;AACA,QAAMW,SAAS,GAAGV,cAAc,CAACG,MAAM,CAACI,MAAR,CAAhC;AACA,QAAMI,GAAG,GAAGhB,MAAM,EAAlB;AACA,MAAIiB,IAAJ;AAEA,QAAMC,OAAO,GAAGnB,OAAO,CAAC,MAAM;AAC5BoB,IAAAA,OAAO,CAACC,GAAR,CAAYZ,MAAM,CAACO,SAAnB;AACA,UAAMM,UAAU,GAAGb,MAAM,CAACc,SAA1B;AACA,UAAMC,QAAQ,GAAGf,MAAM,CAACe,QAAxB,CAH4B,CAK5B;;AACA,QAAIC,OAAO,GAAG,EAAd;;AACA,QAAIH,UAAU,KAAIN,SAAJ,aAAIA,SAAJ,uBAAIA,SAAS,CAAGM,UAAU,CAAC,CAAD,CAAb,CAAb,CAAd,EAA8C;AAC5C,WAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,UAAU,CAACK,MAAX,GAAoB,CAAxC,EAA2CD,CAAC,EAA5C,EAAgD;AAC9C,aAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,SAAS,CAACM,UAAU,CAACI,CAAD,CAAX,CAAT,CAAyBC,MAA7C,EAAqDC,CAAC,EAAtD,EAA0D;AACxD,gBAAMC,IAAI,GAAGb,SAAS,CAACM,UAAU,CAACI,CAAD,CAAX,CAAT,CAAyBE,CAAzB,CAAb;AACA,gBAAME,EAAE,GAAGd,SAAS,CAACM,UAAU,CAACI,CAAC,GAAG,CAAL,CAAX,CAAT,CAA6BE,CAA7B,CAAX;AACA,gBAAMG,MAAM,GAAGf,SAAS,CAACQ,QAAQ,CAACE,CAAD,CAAT,CAAT,CAAuBE,CAAvB,CAAf;AACA,gBAAMI,SAAS,GAAG,CAACH,IAAD,EAAOC,EAAP,EAAWC,MAAX,CAAlB;AACAN,UAAAA,OAAO,CAACO,SAAD,CAAP,GAAqBA,SAArB;AACD;AACF;;AACD,UAAIC,IAAI,GAAG,EAAX;AACA,UAAIP,CAAC,GAAG,CAAR;;AACA,WAAK,IAAIQ,GAAT,IAAgBT,OAAhB,EAAyB;AACvBQ,QAAAA,IAAI,CAACP,CAAD,CAAJ,GAAUD,OAAO,CAACS,GAAD,CAAjB;AACAR,QAAAA,CAAC;AACF;AACF;AACF,GAxBsB,EAwBpB,CAACjB,MAAD,EAASO,SAAT,CAxBoB,CAAvB;AA0BAd,EAAAA,GAAG,CAACiC,KAAJ,CAAU,YAAY;AAEpBjB,IAAAA,IAAI,GAAGhB,GAAG,CAACkC,IAAJ,CAASC,GAAT,CAAa,UAAb,CAAP;AACA,QAAIC,MAAM,GAAGpB,IAAI,CAACqB,SAAL,CAAeC,QAAf,CAAwBC,IAAxB,CACXtC,OAAO,CAACuC,MAAR,CAAeL,GAAf,CAAmBnB,IAAnB,EAAyB;AACvByB,MAAAA,aAAa,EAAE,MADQ;AAEvBC,MAAAA,aAAa,EAAE,IAFQ;AAGvBC,MAAAA,UAAU,EAAE,OAHW;AAIvBC,MAAAA,YAAY,EAAE,GAJS;AAKvBC,MAAAA,SAAS,EAAE,MALY;AAMvBC,MAAAA,WAAW,EAAE,GANU;AAOvBC,MAAAA,SAAS,EAAE,CAPY;AAQvBC,MAAAA,WAAW,EAAE,CARU;AASvBC,MAAAA,OAAO,EAAE;AATc,KAAzB,CADW,CAAb;AAcAb,IAAAA,MAAM,CAACc,KAAP,CAAaC,QAAb,CAAsBC,MAAtB,CAA6B;AAC3BC,MAAAA,WAAW,EAAE,IADc;AAE3BC,MAAAA,SAAS,EAAE,QAFgB;AAG3BC,MAAAA,oBAAoB,EAAE;AAHK,KAA7B;AAMAnB,IAAAA,MAAM,CAACoB,KAAP,CAAaC,UAAb,CAAwBN,QAAxB,CAAiCO,QAAjC,CAA0CC,GAA1C,CAA8C,aAA9C,EAA6D,UAASC,WAAT,EAAsBC,MAAtB,EAA8B;AACzF,YAAMX,KAAK,GAAGW,MAAM,CAACC,QAAP,CAAgBC,SAAhB,CAA0BC,aAA1B,IAA2C,EAAzD;AACA,UAAIC,OAAO,GAAG,EAAd;;AAEA,UAAIf,KAAK,IAAIA,KAAK,CAACzB,MAAN,GAAe,CAA5B,EAA+B;AAC7ByB,QAAAA,KAAK,CAACgB,OAAN,CAAeC,IAAD,IAAU;AACtBF,UAAAA,OAAO,IAAK,GAAEE,IAAI,CAACC,WAAL,CAAiBzC,IAAK,MAAKwC,IAAI,CAACC,WAAL,CAAiBC,KAAM,KAAhE;AACD,SAFD;AAGD;;AACD,aAAOJ,OAAP;AACD,KAVD;AAaA7B,IAAAA,MAAM,CAACoB,KAAP,CAAac,MAAb,CAAoBnB,QAApB,CAA6BC,MAA7B,CAAoC;AAClCmB,MAAAA,IAAI,EAAE;AAD4B,KAApC;;AAIA,QAAItD,OAAO,IAAIA,OAAO,CAACQ,MAAR,GAAiB,CAAhC,EAAmC;AACjCW,MAAAA,MAAM,CAACL,IAAP,CAAYqB,MAAZ,CAAmBnC,OAAnB;AACD,KAFD,MAEO;AACLmB,MAAAA,MAAM,CAACL,IAAP,CAAYqB,MAAZ,CAAmB,EAAnB;AACD;;AAED,SAAKpC,IAAL,GAAYA,IAAZ;AACAoB,IAAAA,MAAM,CAACoC,MAAP,CAAc,IAAd,EAAoB,GAApB;AACD,GAhDD;AAkDAnE,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,KAAKW,IAAT,EAAe;AACbA,MAAAA,IAAI,CAACyD,OAAL;AACD;AACF,GAJQ,EAIN,EAJM,CAAT;AAMA,sBACE;AAAK,IAAA,EAAE,EAAC,UAAR;AAAmB,IAAA,KAAK,EAAE;AAAEC,MAAAA,KAAK,EAAE,MAAT;AAAiBC,MAAAA,MAAM,EAAE;AAAzB,KAA1B;AAA4D,IAAA,GAAG,EAAE5D;AAAjE;AAAA;AAAA;AAAA;AAAA,UADF;AAGD;;GA3FQF,G;UACQV,S,EACGC,c;;;KAFXS,G;AA6FT,eAAeA,GAAf","sourcesContent":["import \"./App.css\";\n\nimport { useMemo, useRef } from \"react\";\nimport * as am5 from '@amcharts/amcharts5';\nimport * as am5Flow from '@amcharts/amcharts5/flow';\n\nimport {\n  client,\n  useConfig,\n  useElementData,\n} from \"@sigmacomputing/plugin\";\nimport { useEffect } from \"react/cjs/react.production.min\";\nimport { randomNormal } from \"d3\";\n\nclient.config.configureEditorPanel([\n  { name: \"source\", type: \"element\" },\n  { name: \"dimension\", type: \"column\", source: \"source\", allowMultiple: true },\n  { name: \"measures\", type: \"column\", source: \"source\", allowMultiple: true },\n]);\n\nfunction App() {\n  const config = useConfig();\n  const sigmaData = useElementData(config.source);\n  const ref = useRef();\n  let root;\n\n  const options = useMemo(() => {\n    console.log(config.sigmaData);\n    const dimensions = config.dimension;\n    const measures = config.measures;\n\n    // transform sigmaData --> sankey data\n    let dataMap = [];\n    if (dimensions && sigmaData?.[dimensions[0]]) {\n      for (let i = 0; i < dimensions.length - 1; i++) {\n        for (let j = 0; j < sigmaData[dimensions[i]].length; j++) {\n          const from = sigmaData[dimensions[i]][j];\n          const to = sigmaData[dimensions[i + 1]][j];\n          const weight = sigmaData[measures[i]][j];\n          const dataPoint = [from, to, weight];\n          dataMap[dataPoint] = dataPoint;\n        }\n      }\n      let data = [];\n      let i = 0;\n      for (var key in dataMap) {\n        data[i] = dataMap[key];\n        i++;\n      }\n    }\n  }, [config, sigmaData]);\n\n  am5.ready(function () {\n\n    root = am5.Root.new(\"chartdiv\");\n    let series = root.container.children.push(\n      am5Flow.Sankey.new(root, {\n        sourceIdField: \"from\",\n        targetIdField: \"to\",\n        valueField: \"value\",\n        paddingRight: 150,\n        nodeAlign: 'left',\n        nodePadding: 100,\n        nodeWidth: 8,\n        linkTension: 0,\n        idField: \"id\",\n      })\n    );\n  \n    series.links.template.setAll({\n      fillOpacity: 0.55,\n      fillStyle: \"source\",\n      controlPointDistance: 0,\n    });\n  \n    series.nodes.rectangles.template.adapters.add('tooltipText', function(tooltipText, target) {\n      const links = target.dataItem._settings.incomingLinks || [];\n      let toolTip = \"\";\n  \n      if (links && links.length > 0) {\n        links.forEach((node) => {\n          toolTip += `${node.dataContext.from} - ${node.dataContext.value} \\n`;\n        });\n      } \n      return toolTip;\n    });\n  \n  \n    series.nodes.labels.template.setAll({\n      text: \"[bold]{name}: {sumIncoming}\"\n    });\n  \n    if (options && options.length > 0) {\n      series.data.setAll(options);\n    } else {\n      series.data.setAll([]);\n    }\n  \n    this.root = root;\n    series.appear(1000, 500);\n  });\n\n  useEffect(() => {\n    if (this.root) {\n      root.dispose();\n    }\n  }, []);\n\n  return (\n    <div id=\"chartdiv\" style={{ width: \"100%\", height: \"98vh\"}} ref={ref}></div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}